---
description: >-
  an open-source infrastructure automation and configuration management tool.
  Pull based model with agents (minions)
---

# Saltstack

**4505/tcp** - ZeroMQ Sub channel

**4506/tcp** - ZeroMQ Req channel, the main channel to

communicate with salt-master

**8000/tcp** (optional) - salt-master REST API. Almost all

endpoints require eauth (e.g. PAM) authorization



{% embed url="https://skylightcyber.com/2023/02/09/a-salt-attacking-saltstack/" %}

## Check unauth api

```
curl http://host:8000/minions
```

## ZeroMQ sploit

### PoC exploit for CVE-2020-11651 and CVE-2020-11652

{% embed url="https://github.com/jasperla/CVE-2020-11651-poc" %}

another one

{% embed url="https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652/tree/main" %}

### Chaining CVE-2021-25281 and CVE-2021-25282

Login bypass & arbitrary file write

**Goals**:

* ssh key
* cron job
* register rogue minion

{% embed url="https://github.com/Immersive-Labs-Sec/CVE-2021-25281" %}

## Register minion

_compose_

```yaml
services:
  minion:
    image: "saltstack/salt:latest"
    command: salt-minion -l info
    # depends_on:
    #   - master
    volumes:
      - ./minion:/etc/salt/minion

```

_./minion_

```
master: master     # master ip
id: testtest       # uniq minon id (it could be random)
log_level: info    # info/debug
```
