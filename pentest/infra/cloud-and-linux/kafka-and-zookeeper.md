# Kafka & Zookeeper

| Параметр          | PLAIN                                     | PLAINTEXT                        | SCRAM                     |
| ----------------- | ----------------------------------------- | -------------------------------- | ------------------------- |
| **Тип**           | Механизм аутентификации                   | Протокол связи                   | Механизм аутентификации   |
| **Передача**      | Имя пользователя и пароль в открытом виде | Данные передаются без шифрования | Хешированные пароли, соль |
| **Использование** | Чаще всего с SSL/TLS для защиты           | Тестирование, разработка         | Продуктивные окружения    |

### Kafka

{% embed url="https://github.blog/security/vulnerability-research/3-ways-to-get-remote-code-execution-in-kafka-ui/" %}

### Kafka Connect

[Kcat](https://github.com/edenhill/kcat) - Generic command line non-JVM Apache Kafka producer and consumer

**List all topics**

```bash
kcat -b 192.168.1.1:9092 -X security.protocol=SASL_SSL -X sasl.mechanism=SCRAM-SHA-256 -X sasl.username='username' -X sasl.password='P@$$W0RD' -X enable.ssl.certificate.verification=false -L
```

**List topic 'mytopic'**

```bash
kcat -b 192.168.1.1:9092 -X security.protocol=SASL_SSL -X sasl.mechanism=SCRAM-SHA-256 -X sasl.username='username' -X sasl.password='P@$$W0RD' -X enable.ssl.certificate.verification=false -t mytopic
```



### Zookeeper&#x20;

Работает на TCP 2181 и по умолчанию доступен без аутентификации. Позволяет получить статистику о кластере, информацию об узлах, выключить сервер и т.д

Все команды:&#x20;

1. dump: Lists the outstanding sessions and ephemeral nodes. This only works on the leader.
2. envi: Print details about serving environment
3. kill: Shuts down the server. This must be issued from the machine the ZooKeeper server is running on
4. reqs: List outstanding requests
5. ruok: Tests if server is running in a non-error state. The server will respond with imok if it is running. Otherwise it will not respond at all
6. srst: Reset statistics returned by stat command
7. stat: Lists statistics about performance and connected clients

Отправить команду: `echo ruok | nc 192.168.1.1 2181`

### Zookeeper Connect

```bash
./zkCli.sh -server 10.20.176.123:2181
```

### Create user in kafka via zookeeper

```bash
kafka-configs.sh --zookeeper 192.168.1.1:2181 --alter --add-config 'SCRAM-SHA-256=[password=P@$$W0RD]' --entity-type users --entity-name username
```

### Give ACL rights via zookeeper

```bash
kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181 \
  --add --allow-principal User:username \
  --operation All --topic '*' --group '*' --cluster

```
