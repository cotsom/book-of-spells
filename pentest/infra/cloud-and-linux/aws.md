# AWS

## Get IMDSv2 token

```bash
curl -s -X PUT \
  "http://169.254.169.254/latest/api/token" \
  -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"
```

## Get EC2 metadata

```bash
curl -s -H "X-aws-ec2-metadata-token: $IMDSV2TOKEN" \
  "http://169.254.169.254/latest/meta-data/iam/security-credentials/"
```

## Creds validation

```bash
export AWS_ACCESS_KEY_ID=
export AWS_SECRET_ACCESS_KEY=
export AWS_SESSION_TOKEN=

aws sts get-caller-identity --output json
```

## S3

```bash
# List backet
aws s3 ls s3://backet-name/ --recursive

# Get object
aws s3 cp "s3://backet-name/path/to/file" ./filename

# Generate presigned url
aws s3 presign "s3://backet-name/folder/file.txt" --region us-east-1
```
