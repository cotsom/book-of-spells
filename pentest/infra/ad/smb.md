# SMB

## DFS

Предположим вы увидели шару `\\domain.local\shara` Перейдя на нее с винды все успешно откроется, однако с линуха вас постигнет неудача. Дело в алиасах придуманных майками ([DFS](https://en.wikipedia.org/wiki/Distributed_File_System_\(Microsoft\))). Чтобы не городить всякие туловины на винду можно вычитать все refferals, чтобы узнать настоящие хосты и шары и успешно подключиться с линуха. Извлекаем из лдапа все объекты про это дерьмо.&#x20;

```bash
nxc ldap dc.domain.local -u user -p pass --query "(objectClass=msDFS-Linkv2)" ""
```

&#x20;Получаем партянку, нас интересуют `msDFS-LinkPathv2`  - это название папки идущее после `\\domain.local\shara\`  и `msDFS-TargetListv2`  это utf16 блоба - пихаем ее в ванлайнер ниже

```bash
echo 'BLOB' | iconv -f UTF-16LE -t UTF-8 2>/dev/null | grep -o '<target[^>]*>[^<]*</target>' | sed 's/<[^>]*>//g'
```

