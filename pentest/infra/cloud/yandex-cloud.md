# Yandex Cloud

### From zero

```bash
curl -H "Metadata-Flavor: Google" \
  http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token
```

### Setup

Install [cli](https://yandex.cloud/ru/docs/cli/operations/install-cli)

if have like as  `auth.json`

```json
{
  "id": "someid",
  "service_account_id": "serviceaccountid",
  "created_at": "2021-5-03T15:12:26.845046583Z",
  "key_algorithm": "RSA_2048",
  "public_key": "..",
  "private_key": "..."
}
```

```bash
yc config set service-account-key auth.json
yc config set cloud-id cloud_id_here 
```

### Rights

```bash
yc resource-manager cloud list
yc resource-manager folder list

# Regions
yc compute zone list

# Service Accounts
yc iam service-account list --folder-id <folder_id>

# Roles 
yc resource-manager folder list-access-bindings <folder_id>

# Quotas 
yc compute quota list --folder-id <folder_id> --format yaml
```

### Compute

```bash
# Hypervisors check
yc compute host-group list --folder-id <folder_id>

# Compute instances list
yc compute instance list --folder-id <folder_id> --format json

# Instance details (Full info including metadata/user-data)
yc compute instance get <instance_id> --full --format json
```

### Get access

```bash

# Connect via Serial Console (URL)
yc compute instance get-serial-port-url <instance_id>

# Console logs (Serial port output)
yc compute instance get-serial-port-output <instance_id> --port 1

# NEED CHECK !! Add pubkey
yc compute instance add-metadata-from-file <instance_id> ssh-keys=my_key.pub
```

### Managed k8s

```bash
yc k8s cluster list --folder-id <folder_id>

#issue kubeconfig 
yc k8s cluster get-credentials <cluster-id> --internal --folder-id <folder_id>

```

### Snapshot

```bash
# Instance Snapshot
yc compute snapshot create --name <snap_name> --folder-id <folder_id> \
  --description "backup" --instance-id <instance_id>

# Volume Snapshot
yc compute snapshot create --name <snap_name> --disk-id <disk_id>

# Forensic Volume (Create disk from snapshot to attach elsewhere)
yc compute disk create --name <forensic_disk_name> \
  --source-snapshot-id <snapshot_id> --folder-id <folder_id>

# Attach forensic disk to your controlled instance
yc compute instance attach-disk <your_vm_id> \
  --disk-name <forensic_disk_name> --mode rw
```

