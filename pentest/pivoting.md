# PIVOTING

### Tun2socks

_Create interface:_

```bash
$ sudo ip tuntap add mode tun dev t2s
$ sudo ip a add 10.0.0.0/8 dev t2s # target network (behind socks host)
$ sudo ip t2s set up dev t2s
```

_Start `tun2socks`:_

```bash
$ sudo tun2socks -proxy socks5://127.0.0.1:1080 -device tun://t2s
```

_Redact dns for interface (`systemd-resolved`):_

```bash
$ sudo resolvectl dns l 10.1.2.1 10.1.3.1 # dns servers
$ sudo resolvectl mdns l yes # allow TCP
$ sudo resolvectl domain l test.com # resolve domain, same as search
```

_Check configure:_

```bash
$ resolvectl status
...
Link 3 (t2s)
    Current Scopes: DNS LLMNR/IPv4 LLMNR/IPv6 mDNS/IPv4 mDNS/IPv6
         Protocols: +DefaultRoute +LLMNR +mDNS -DNSOverTLS DNSSEC=no/unsupported
Current DNS Server: 10.1.2.1
       DNS Servers: 10.1.3.1
        DNS Domain: test.com
...
```
